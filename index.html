<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campus Canteen Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .gradient-bg { background: linear-gradient(135deg, #ff7e5f 0%, #feb47b 100%); }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .glass-effect { background: rgba(255, 255, 255, 0.25); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.18); }
        .floating { animation: floating 3s ease-in-out infinite; }
        @keyframes floating { 0% { transform: translate(0, 0px); } 50% { transform: translate(0, 15px); } 100% { transform: translate(0, -0px); } }
        
        /* Custom styles for image display */
        .menu-item-image {
            width: 64px;
            height: 64px;
            object-fit: cover;
            border-radius: 8px;
        }
        .cart-item-image {
            width: 48px;
            height: 48px;
            object-fit: cover;
            border-radius: 6px;
        }
        .receipt-item-image {
            width: 40px;
            height: 40px;
            object-fit: cover;
            border-radius: 4px;
        }
        .owner-menu-image {
            width: 64px;
            height: 64px;
            object-fit: cover;
            border-radius: 8px;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-orange-50 to-white min-h-screen">

    <!-- Auth Screen with Registration/Login Toggle -->
    <div id="auth-screen" class="min-h-screen flex items-center justify-center px-4">
        <div class="max-w-md w-full">
            <div class="bg-white rounded-2xl shadow-2xl p-8">
                <div class="text-center mb-8">
                    <div class="w-20 h-20 bg-gradient-to-r from-orange-500 to-orange-600 rounded-full flex items-center justify-center mx-auto mb-4 floating">
                        <span class="text-white text-3xl">üçΩÔ∏è</span>
                    </div>
                    <h1 class="text-3xl font-bold text-gray-800">Campus Canteen</h1>
                    <p class="text-gray-600 mt-2">Smart Management System</p>
                </div>

                <!-- Toggle between Login and Register -->
                <div class="flex mb-6 bg-gray-100 rounded-lg p-1">
                    <button id="login-tab" class="flex-1 py-2 rounded-md font-medium transition-colors bg-orange-500 text-white">Login</button>
                    <button id="register-tab" class="flex-1 py-2 rounded-md font-medium transition-colors text-gray-600">Register</button>
                </div>

                <!-- Login Form -->
                <div id="login-form">
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-medium mb-2">User Type</label>
                        <select id="user-type" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                            <option value="student">Student</option>
                            <option value="owner">Canteen Owner</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Username</label>
                        <input type="text" id="login-username" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent" placeholder="Enter username">
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Password</label>
                        <input type="password" id="login-password" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent" placeholder="Enter password">
                    </div>
                    <button onclick="login()" class="w-full bg-orange-500 text-white py-3 rounded-lg hover:bg-orange-600 transition-colors font-medium mb-4">Login</button>
                </div>

                <!-- Register Form -->
                <div id="register-form" class="hidden">
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-medium mb-2">User Type</label>
                        <select id="register-user-type" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent">
                            <option value="student">Student</option>
                            <option value="owner">Canteen Owner</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Full Name</label>
                        <input type="text" id="register-name" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent" placeholder="Enter full name">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Email</label>
                        <input type="email" id="register-email" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent" placeholder="Enter email">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Username</label>
                        <input type="text" id="register-username" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent" placeholder="Choose username">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Password</label>
                        <input type="password" id="register-password" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent" placeholder="Create password">
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-medium mb-2">Confirm Password</label>
                        <input type="password" id="register-confirm-password" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent" placeholder="Confirm password">
                    </div>
                    <button onclick="register()" class="w-full bg-orange-500 text-white py-3 rounded-lg hover:bg-orange-600 transition-colors font-medium mb-4">Create Account</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Student Dashboard -->
    <div id="student-dashboard" class="hidden">
        <nav class="bg-white shadow-lg sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center space-x-2">
                        <div class="w-10 h-10 bg-gradient-to-r from-orange-500 to-orange-600 rounded-lg flex items-center justify-center">
                            <span class="text-white font-bold text-lg">üçΩÔ∏è</span>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold text-gray-800">Campus Canteen</h1>
                            <p class="text-sm text-gray-600" id="student-greeting">Hi Student üëã</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button onclick="showStudentSection('menu')" class="text-orange-500 font-medium">Menu</button>
                        <button onclick="showStudentSection('booking')" class="text-gray-600 hover:text-orange-500 font-medium">Book Seat</button>
                        <button onclick="showStudentSection('orders')" class="text-gray-600 hover:text-orange-500 font-medium">Orders</button>
                        <button onclick="showStudentSection('profile')" class="text-gray-600 hover:text-orange-500 font-medium">Profile</button>
                        <button onclick="toggleCart()" class="bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 transition-colors font-medium">
                            <i class="fas fa-shopping-cart mr-1"></i> Cart (<span id="cart-count">0</span>)
                        </button>
                        <button onclick="logout()" class="text-gray-600 hover:text-orange-500 font-medium">Logout</button>
                    </div>
                </div>
            </div>
        </nav>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Notices Display -->
            <div id="notices-display" class="mb-6"></div>

            <!-- Menu Section -->
            <div id="student-menu-section" class="student-section">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Today's Menu</h2>
                <div class="flex mb-6 space-x-2 overflow-x-auto pb-2">
                    <button onclick="filterMenu('all')" class="category-filter px-4 py-2 bg-orange-500 text-white rounded-full text-sm font-medium">All</button>
                    <button onclick="filterMenu('breakfast')" class="category-filter px-4 py-2 bg-gray-200 text-gray-700 rounded-full text-sm font-medium hover:bg-orange-100 hover:text-orange-700">Breakfast</button>
                    <button onclick="filterMenu('lunch')" class="category-filter px-4 py-2 bg-gray-200 text-gray-700 rounded-full text-sm font-medium hover:bg-orange-100 hover:text-orange-700">Lunch</button>
                    <button onclick="filterMenu('snacks')" class="category-filter px-4 py-2 bg-gray-200 text-gray-700 rounded-full text-sm font-medium hover:bg-orange-100 hover:text-orange-700">Snacks</button>
                    <button onclick="filterMenu('beverages')" class="category-filter px-4 py-2 bg-gray-200 text-gray-700 rounded-full text-sm font-medium hover:bg-orange-100 hover:text-orange-700">Beverages</button>
                </div>
                <div id="menu-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
            </div>

            <!-- Booking Section -->
            <div id="student-booking-section" class="student-section hidden">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Book a Seat</h2>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-semibold mb-4">Select Time Slot</h3>
                    <div id="time-slots" class="grid grid-cols-2 gap-4 mb-6"></div>
                    <div id="selected-slot-info" class="hidden mb-4 p-4 bg-orange-50 rounded-lg">
                        <p class="text-orange-700">Selected: <span id="selected-time-text"></span></p>
                    </div>
                    <button onclick="bookSeat()" id="book-btn" class="w-full bg-orange-500 text-white py-3 rounded-lg hover:bg-orange-600 transition-colors font-medium" disabled>Select a Time Slot</button>
                </div>
            </div>

            <!-- Orders Section -->
            <div id="student-orders-section" class="student-section hidden">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">My Orders & Bookings</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-semibold mb-4">Recent Orders</h3>
                        <div id="orders-list"></div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-semibold mb-4">Seat Bookings</h3>
                        <div id="bookings-list"></div>
                    </div>
                </div>
            </div>

            <!-- Profile Section -->
            <div id="student-profile-section" class="student-section hidden">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">My Profile</h2>
                <div class="bg-white rounded-xl shadow-lg p-6 max-w-2xl">
                    <div class="flex items-center space-x-4 mb-6">
                        <div class="w-20 h-20 bg-gradient-to-r from-orange-500 to-orange-600 rounded-full flex items-center justify-center">
                            <span class="text-white text-2xl"><i class="fas fa-user"></i></span>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold" id="profile-name">Aryan Kumar</h3>
                            <p class="text-gray-600" id="profile-email">aryan@campus.edu</p>
                            <p class="text-gray-500 text-sm" id="profile-type">Student</p>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-600">Total Orders</p>
                            <p class="text-2xl font-bold text-orange-600" id="profile-total-orders">0</p>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p class="text-sm text-gray-600">Total Spent</p>
                            <p class="text-2xl font-bold text-orange-600" id="profile-total-spent">$0.00</p>
                        </div>
                    </div>
                    <div class="border-t pt-6">
                        <h4 class="font-semibold mb-4">Account Information</h4>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Student ID</label>
                                <input type="text" id="profile-student-id" class="w-full p-3 border border-gray-300 rounded-lg" value="STU001" readonly>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                                <input type="text" id="profile-phone" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="Add phone number">
                            </div>
                            <button onclick="updateProfile()" class="bg-orange-500 text-white py-2 px-6 rounded-lg hover:bg-orange-600 transition-colors font-medium">Update Profile</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cart Sidebar -->
        <div id="cart-sidebar" class="fixed right-0 top-0 h-full w-80 bg-white shadow-2xl transform translate-x-full transition-transform duration-300 z-50">
            <div class="p-6 border-b">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-semibold">Your Cart</h3>
                    <button onclick="toggleCart()" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
                </div>
            </div>
            <div id="cart-items" class="p-6 flex-1 overflow-y-auto" style="height: calc(100vh - 200px);"></div>
            <div class="p-6 border-t bg-gray-50">
                <div class="flex justify-between items-center mb-4">
                    <span class="font-semibold">Total:</span>
                    <span id="cart-total" class="font-bold text-xl text-orange-600">$0.00</span>
                </div>
                <button onclick="placeOrder()" id="place-order-btn" class="w-full bg-orange-500 text-white py-3 rounded-lg hover:bg-orange-600 transition-colors font-medium" disabled>Place Order</button>
            </div>
        </div>
    </div>

    <!-- Owner Dashboard -->
    <div id="owner-dashboard" class="hidden">
        <nav class="bg-white shadow-lg sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center space-x-2">
                        <div class="w-10 h-10 bg-gradient-to-r from-orange-500 to-orange-600 rounded-lg flex items-center justify-center">
                            <span class="text-white font-bold text-lg">üë®‚Äçüíº</span>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold text-gray-800">Canteen Management</h1>
                            <p class="text-sm text-gray-600" id="owner-greeting">Hi Owner üëã</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button onclick="showOwnerSection('dashboard')" class="text-orange-500 font-medium">Dashboard</button>
                        <button onclick="showOwnerSection('menu')" class="text-gray-600 hover:text-orange-500 font-medium">Menu</button>
                        <button onclick="showOwnerSection('bookings')" class="text-gray-600 hover:text-orange-500 font-medium">Bookings</button>
                        <button onclick="showOwnerSection('orders')" class="text-gray-600 hover:text-orange-500 font-medium">Orders</button>
                        <button onclick="showOwnerSection('notices')" class="text-gray-600 hover:text-orange-500 font-medium">Notices</button>
                        <button onclick="showOwnerSection('analytics')" class="text-gray-600 hover:text-orange-500 font-medium">Analytics</button>
                        <button onclick="logout()" class="text-gray-600 hover:text-orange-500 font-medium">Logout</button>
                    </div>
                </div>
            </div>
        </nav>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Dashboard Overview -->
            <div id="owner-dashboard-section" class="owner-section">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Dashboard Overview</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">Today's Revenue</p>
                                <p class="text-2xl font-bold text-green-600" id="today-revenue">$0</p>
                            </div>
                            <div class="bg-green-100 p-3 rounded-full">
                                <span class="text-green-600 text-xl">üí∞</span>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">Orders Today</p>
                                <p class="text-2xl font-bold text-blue-600" id="today-orders">0</p>
                            </div>
                            <div class="bg-blue-100 p-3 rounded-full">
                                <span class="text-blue-600 text-xl">üìã</span>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">Seat Bookings</p>
                                <p class="text-2xl font-bold text-orange-600" id="today-bookings">0</p>
                            </div>
                            <div class="bg-orange-100 p-3 rounded-full">
                                <span class="text-orange-600 text-xl">ü™ë</span>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm">Active Notices</p>
                                <p class="text-2xl font-bold text-purple-600" id="active-notices-count">0</p>
                            </div>
                            <div class="bg-purple-100 p-3 rounded-full">
                                <span class="text-purple-600 text-xl">üì¢</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                    <h3 class="text-xl font-semibold mb-4">Quick Actions</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <button onclick="showOwnerSection('menu')" class="p-4 bg-orange-50 rounded-lg text-center hover:bg-orange-100 transition-colors">
                            <span class="text-2xl block mb-2">üçΩÔ∏è</span>
                            <span class="font-medium text-orange-700">Manage Menu</span>
                        </button>
                        <button onclick="showOwnerSection('orders')" class="p-4 bg-blue-50 rounded-lg text-center hover:bg-blue-100 transition-colors">
                            <span class="text-2xl block mb-2">üì¶</span>
                            <span class="font-medium text-blue-700">Process Orders</span>
                        </button>
                        <button onclick="showOwnerSection('bookings')" class="p-4 bg-green-50 rounded-lg text-center hover:bg-green-100 transition-colors">
                            <span class="text-2xl block mb-2">ü™ë</span>
                            <span class="font-medium text-green-700">View Bookings</span>
                        </button>
                        <button onclick="showOwnerSection('notices')" class="p-4 bg-purple-50 rounded-lg text-center hover:bg-purple-100 transition-colors">
                            <span class="text-2xl block mb-2">üì¢</span>
                            <span class="font-medium text-purple-700">Post Notice</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Menu Management -->
            <div id="owner-menu-section" class="owner-section hidden">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Menu Management</h2>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2">
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h3 class="text-xl font-semibold mb-4">Current Menu Items</h3>
                            <div id="owner-menu-list"></div>
                        </div>
                    </div>
                    <div>
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h3 class="text-xl font-semibold mb-4">Add New Item</h3>
                            <form id="add-item-form" class="space-y-4">
                                <input type="text" id="item-name" placeholder="Item Name" required class="w-full p-3 border border-gray-300 rounded-lg">
                                <input type="number" id="item-price" placeholder="Price ($)" step="0.01" min="0" required class="w-full p-3 border border-gray-300 rounded-lg">
                                <select id="item-category" required class="w-full p-3 border border-gray-300 rounded-lg">
                                    <option value="">Select Category</option>
                                    <option value="breakfast">Breakfast</option>
                                    <option value="lunch">Lunch</option>
                                    <option value="snacks">Snacks</option>
                                    <option value="beverages">Beverages</option>
                                </select>
                                <textarea id="item-description" placeholder="Description" rows="3" required class="w-full p-3 border border-gray-300 rounded-lg"></textarea>
                                <!-- Image URL input field -->
                                <input type="url" id="item-image-url" placeholder="Image URL (optional)" class="w-full p-3 border border-gray-300 rounded-lg">
                                <button type="submit" class="w-full bg-orange-500 text-white py-3 rounded-lg hover:bg-orange-600 transition-colors font-medium">Add Item</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bookings Management -->
            <div id="owner-bookings-section" class="owner-section hidden">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Seat Booking Management</h2>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-semibold mb-4">Seat Capacity Settings</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Total Seats per Slot</label>
                                <input type="number" id="total-seats" min="1" max="100" value="20" class="w-full p-3 border border-gray-300 rounded-lg">
                            </div>
                            <button onclick="updateCapacity()" class="w-full bg-orange-500 text-white py-2 rounded-lg hover:bg-orange-600 transition-colors">Update Capacity</button>
                        </div>
                    </div>
                    <div class="lg:col-span-2 bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-semibold mb-4">Booking Overview</h3>
                        <div id="booking-overview"></div>
                    </div>
                </div>
            </div>

            <!-- Orders Management -->
            <div id="owner-orders-section" class="owner-section hidden">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Order Management</h2>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-semibold mb-4">Active Orders</h3>
                    <div id="owner-orders-list"></div>
                </div>
            </div>

            <!-- Notices Management -->
            <div id="owner-notices-section" class="owner-section hidden">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Notices & Announcements</h2>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2">
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h3 class="text-xl font-semibold mb-4">Active Notices</h3>
                            <div id="notices-list"></div>
                        </div>
                    </div>
                    <div>
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h3 class="text-xl font-semibold mb-4">Create Notice</h3>
                            <form id="notice-form" class="space-y-4">
                                <select id="notice-type" class="w-full p-3 border border-gray-300 rounded-lg">
                                    <option value="info">Information</option>
                                    <option value="warning">Warning</option>
                                    <option value="closure">Canteen Closure</option>
                                    <option value="special">Special Offer</option>
                                </select>
                                <input type="text" id="notice-title" placeholder="Notice title" required class="w-full p-3 border border-gray-300 rounded-lg">
                                <textarea id="notice-message" placeholder="Notice message" rows="4" required class="w-full p-3 border border-gray-300 rounded-lg"></textarea>
                                <input type="datetime-local" id="notice-expiry" class="w-full p-3 border border-gray-300 rounded-lg">
                                <div class="flex items-center space-x-2">
                                    <input type="checkbox" id="notice-urgent" class="rounded">
                                    <label for="notice-urgent" class="text-sm text-gray-600">Mark as urgent</label>
                                </div>
                                <button type="submit" class="w-full bg-orange-500 text-white py-3 rounded-lg hover:bg-orange-600 transition-colors font-medium">Publish Notice</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Section -->
            <div id="owner-analytics-section" class="owner-section hidden">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Business Analytics</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-semibold mb-4">Popular Items</h3>
                        <div id="popular-items" class="space-y-4">
                            <!-- Popular items will be populated here -->
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-semibold mb-4">Revenue Trends</h3>
                        <div id="revenue-chart" class="h-64 flex items-center justify-center text-gray-500">
                            <p>Revenue chart will be displayed here</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Receipt Modal -->
    <div id="receipt-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-8 max-w-md mx-4">
            <div class="text-center mb-6">
                <div class="text-4xl mb-2">üßæ</div>
                <h3 class="text-2xl font-bold text-gray-800">Order Receipt</h3>
            </div>
            <div id="receipt-content" class="space-y-4 mb-6"></div>
            <div class="flex justify-center">
                <button onclick="closeReceipt()" class="px-8 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors">Close</button>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="notification" class="fixed top-4 right-4 bg-white border-l-4 border-green-500 rounded-lg shadow-lg p-4 transform translate-x-full transition-transform duration-300 z-50">
        <div class="flex items-center space-x-3">
            <span id="notification-icon" class="text-2xl">‚úÖ</span>
            <div>
                <p id="notification-title" class="font-semibold text-gray-800">Success!</p>
                <p id="notification-message" class="text-sm text-gray-600">Operation completed</p>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        var currentUser = null;
        var cart = [];
        var selectedSlot = null;
        var notices = [];
        var orders = [];
        var bookings = [];
        var ownerOrders = [];
        var totalSeats = 20;
        var currentMenuFilter = 'all';

        // Menu Data (will be loaded from API)
        var menuItems = [];

        // Time Slots Data (will be loaded from API)
        var timeSlots = [];

        // Authentication Functions
        function login() {
            var username = document.getElementById('login-username').value.trim().toLowerCase();
            var password = document.getElementById('login-password').value.trim();
            var userType = document.getElementById('user-type').value;
            
            if (!username || !password) {
                showNotification('‚ùå', 'Login Failed', 'Please enter username and password');
                return;
            }
            
            // API call to backend
            fetch('http://localhost:5000/api/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    username: username,
                    password: password,
                    userType: userType
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.token) {
                    // Login successful
                    currentUser = data.user;
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('user', JSON.stringify(data.user));
                    
                    document.getElementById('auth-screen').classList.add('hidden');
                    
                    if (currentUser.userType === 'student') {
                        document.getElementById('student-dashboard').classList.remove('hidden');
                        document.getElementById('student-greeting').textContent = 'Hi ' + currentUser.name.split(' ')[0] + ' üëã';
                        initStudent();
                    } else {
                        document.getElementById('owner-dashboard').classList.remove('hidden');
                        document.getElementById('owner-greeting').textContent = 'Hi ' + currentUser.name.split(' ')[0] + ' üëã';
                        initOwner();
                    }
                    
                    showNotification('‚úÖ', 'Login Successful', 'Welcome back, ' + currentUser.name + '!');
                } else {
                    showNotification('‚ùå', 'Login Failed', data.message || 'Invalid credentials');
                }
            })
            .catch(error => {
                console.error('Login error:', error);
                showNotification('‚ùå', 'Login Failed', 'Network error. Please try again.');
            });
        }

        function register() {
            var name = document.getElementById('register-name').value.trim();
            var email = document.getElementById('register-email').value.trim();
            var username = document.getElementById('register-username').value.trim().toLowerCase();
            var password = document.getElementById('register-password').value.trim();
            var confirmPassword = document.getElementById('register-confirm-password').value.trim();
            var userType = document.getElementById('register-user-type').value;

            if (!name || !email || !username || !password || !confirmPassword) {
                showNotification('‚ùå', 'Registration Failed', 'Please fill all fields');
                return;
            }

            if (password !== confirmPassword) {
                showNotification('‚ùå', 'Registration Failed', 'Passwords do not match');
                return;
            }

            if (password.length < 6) {
                showNotification('‚ùå', 'Registration Failed', 'Password must be at least 6 characters long');
                return;
            }

            // API call to backend
            fetch('http://localhost:5000/api/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    name: name,
                    email: email,
                    username: username,
                    password: password,
                    userType: userType
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.token) {
                    // Registration successful
                    currentUser = data.user;
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('user', JSON.stringify(data.user));
                    
                    document.getElementById('auth-screen').classList.add('hidden');
                    
                    if (currentUser.userType === 'student') {
                        document.getElementById('student-dashboard').classList.remove('hidden');
                        document.getElementById('student-greeting').textContent = 'Hi ' + currentUser.name.split(' ')[0] + ' üëã';
                        initStudent();
                    } else {
                        document.getElementById('owner-dashboard').classList.remove('hidden');
                        document.getElementById('owner-greeting').textContent = 'Hi ' + currentUser.name.split(' ')[0] + ' üëã';
                        initOwner();
                    }
                    
                    showNotification('‚úÖ', 'Registration Successful', 'Welcome to Campus Canteen, ' + currentUser.name + '!');
                    
                    // Reset registration form
                    document.getElementById('register-name').value = '';
                    document.getElementById('register-email').value = '';
                    document.getElementById('register-username').value = '';
                    document.getElementById('register-password').value = '';
                    document.getElementById('register-confirm-password').value = '';
                    
                } else {
                    showNotification('‚ùå', 'Registration Failed', data.message || 'Registration failed');
                }
            })
            .catch(error => {
                console.error('Registration error:', error);
                showNotification('‚ùå', 'Registration Failed', 'Network error. Please try again.');
            });
        }

        function logout() {
            currentUser = null;
            cart = [];
            selectedSlot = null;
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            
            document.getElementById('student-dashboard').classList.add('hidden');
            document.getElementById('owner-dashboard').classList.add('hidden');
            document.getElementById('auth-screen').classList.remove('hidden');
            
            // Reset forms
            document.getElementById('login-username').value = '';
            document.getElementById('login-password').value = '';
            
            showNotification('üëã', 'Logged Out', 'See you next time!');
        }

        // Check if user is already logged in on page load
        document.addEventListener('DOMContentLoaded', function() {
            const token = localStorage.getItem('token');
            const userData = localStorage.getItem('user');
            
            if (token && userData) {
                try {
                    currentUser = JSON.parse(userData);
                    
                    document.getElementById('auth-screen').classList.add('hidden');
                    
                    if (currentUser.userType === 'student') {
                        document.getElementById('student-dashboard').classList.remove('hidden');
                        document.getElementById('student-greeting').textContent = 'Hi ' + currentUser.name.split(' ')[0] + ' üëã';
                        initStudent();
                    } else {
                        document.getElementById('owner-dashboard').classList.remove('hidden');
                        document.getElementById('owner-greeting').textContent = 'Hi ' + currentUser.name.split(' ')[0] + ' üëã';
                        initOwner();
                    }
                } catch (error) {
                    console.error('Error parsing user data:', error);
                    localStorage.removeItem('token');
                    localStorage.removeItem('user');
                }
            }
            
            // Setup auth tabs
            document.getElementById('login-tab').addEventListener('click', function() {
                document.getElementById('login-tab').classList.add('bg-orange-500', 'text-white');
                document.getElementById('login-tab').classList.remove('text-gray-600');
                document.getElementById('register-tab').classList.remove('bg-orange-500', 'text-white');
                document.getElementById('register-tab').classList.add('text-gray-600');
                document.getElementById('login-form').classList.remove('hidden');
                document.getElementById('register-form').classList.add('hidden');
            });

            document.getElementById('register-tab').addEventListener('click', function() {
                document.getElementById('register-tab').classList.add('bg-orange-500', 'text-white');
                document.getElementById('register-tab').classList.remove('text-gray-600');
                document.getElementById('login-tab').classList.remove('bg-orange-500', 'text-white');
                document.getElementById('login-tab').classList.add('text-gray-600');
                document.getElementById('register-form').classList.remove('hidden');
                document.getElementById('login-form').classList.add('hidden');
            });
        });

        // API Functions
        function loadMenuItems() {
            fetch('http://localhost:5000/api/menu')
                .then(response => response.json())
                .then(data => {
                    menuItems = data;
                    displayMenu();
                })
                .catch(error => {
                    console.error('Error loading menu:', error);
                    showNotification('‚ùå', 'Error', 'Failed to load menu');
                });
        }

        function loadTimeSlots() {
            fetch('http://localhost:5000/api/time-slots')
                .then(response => response.json())
                .then(data => {
                    timeSlots = data;
                    displayTimeSlots();
                })
                .catch(error => {
                    console.error('Error loading time slots:', error);
                    showNotification('‚ùå', 'Error', 'Failed to load time slots');
                });
        }

        function loadNotices() {
            fetch('http://localhost:5000/api/notices')
                .then(response => response.json())
                .then(data => {
                    notices = data;
                    displayNotices();
                })
                .catch(error => {
                    console.error('Error loading notices:', error);
                    showNotification('‚ùå', 'Error', 'Failed to load notices');
                });
        }

        function loadStudentOrders() {
            const token = localStorage.getItem('token');
            fetch('http://localhost:5000/api/orders', {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            })
            .then(response => response.json())
            .then(data => {
                orders = data;
                displayOrders();
            })
            .catch(error => {
                console.error('Error loading orders:', error);
            });
        }

        function loadStudentBookings() {
            const token = localStorage.getItem('token');
            fetch('http://localhost:5000/api/bookings', {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            })
            .then(response => response.json())
            .then(data => {
                bookings = data;
                displayBookings();
            })
            .catch(error => {
                console.error('Error loading bookings:', error);
            });
        }

        // Student Functions
        function initStudent() {
            loadMenuItems();
            loadTimeSlots();
            loadNotices();
            loadStudentOrders();
            loadStudentBookings();
            updateProfileDisplay();
            updateCartDisplay();
        }

        function showStudentSection(section) {
            var sections = document.querySelectorAll('.student-section');
            for (var i = 0; i < sections.length; i++) {
                sections[i].classList.add('hidden');
            }
            document.getElementById('student-' + section + '-section').classList.remove('hidden');
        }

        function filterMenu(category) {
            currentMenuFilter = category;
            
            // Update active filter button
            var filterButtons = document.querySelectorAll('.category-filter');
            filterButtons.forEach(button => {
                if (button.textContent.toLowerCase() === category || (category === 'all' && button.textContent === 'All')) {
                    button.classList.add('bg-orange-500', 'text-white');
                    button.classList.remove('bg-gray-200', 'text-gray-700', 'hover:bg-orange-100', 'hover:text-orange-700');
                } else {
                    button.classList.remove('bg-orange-500', 'text-white');
                    button.classList.add('bg-gray-200', 'text-gray-700', 'hover:bg-orange-100', 'hover:text-orange-700');
                }
            });
            
            displayMenu();
        }

        function displayMenu() {
            var menuGrid = document.getElementById('menu-grid');
            var html = '';
            
            for (var i = 0; i < menuItems.length; i++) {
                var item = menuItems[i];
                if (item.available && (currentMenuFilter === 'all' || item.category === currentMenuFilter)) {
                    html += '<div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1">';
                    html += '<div class="flex items-center justify-between mb-3">';
                    
                    // FIXED: Check if imageUrl exists and is not empty
                    if (item.imageUrl && item.imageUrl.trim() !== '') {
                        html += '<img src="' + item.imageUrl + '" alt="' + item.name + '" class="menu-item-image" onerror="this.style.display=\'none\'; this.nextElementSibling.style.display=\'block\';">';
                        html += '<span class="text-4xl hidden">' + (item.emoji || 'üçΩÔ∏è') + '</span>';
                    } else {
                        html += '<span class="text-4xl">' + (item.emoji || 'üçΩÔ∏è') + '</span>';
                    }
                    
                    if (item.popular) {
                        html += '<span class="bg-orange-100 text-orange-800 text-xs font-medium px-2 py-1 rounded-full">Popular</span>';
                    }
                    html += '</div>';
                    html += '<h3 class="text-xl font-semibold text-gray-800 mb-2">' + item.name + '</h3>';
                    html += '<p class="text-gray-600 mb-4 text-sm">' + item.description + '</p>';
                    html += '<div class="flex items-center justify-between">';
                    html += '<span class="text-2xl font-bold text-orange-500">$' + item.price.toFixed(2) + '</span>';
                    html += '<button onclick="addToCart(\'' + item._id + '\')" class="bg-orange-500 text-white py-2 px-4 rounded-lg hover:bg-orange-600 transition-colors font-medium">Add to Cart</button>';
                    html += '</div></div>';
                }
            }
            
            if (html === '') {
                html = '<div class="col-span-3 text-center py-12 text-gray-500"><span class="text-4xl mb-4 block">üçΩÔ∏è</span><p class="text-lg">No items found in this category</p></div>';
            }
            
            menuGrid.innerHTML = html;
        }

        function displayNotices() {
            var noticesDisplay = document.getElementById('notices-display');
            var html = '';
            
            for (var i = 0; i < notices.length; i++) {
                var notice = notices[i];
                var bgClass = 'bg-blue-50 border-blue-500 text-blue-700';
                var icon = '‚ÑπÔ∏è';
                
                if (notice.type === 'warning') {
                    bgClass = 'bg-yellow-50 border-yellow-500 text-yellow-700';
                    icon = '‚ö†Ô∏è';
                } else if (notice.type === 'closure') {
                    bgClass = 'bg-red-50 border-red-500 text-red-700';
                    icon = 'üö´';
                } else if (notice.type === 'special') {
                    bgClass = 'bg-green-50 border-green-500 text-green-700';
                    icon = 'üéâ';
                }

                html += '<div class="border-l-4 p-4 mb-4 ' + bgClass + '">';
                html += '<div class="flex items-start space-x-3">';
                html += '<span class="text-2xl">' + icon + '</span>';
                html += '<div class="flex-1">';
                html += '<h4 class="font-semibold text-lg">' + notice.title + '</h4>';
                html += '<p class="mt-1">' + notice.message + '</p>';
                if (notice.urgent) {
                    html += '<span class="inline-block mt-2 bg-red-500 text-white px-2 py-1 rounded-full text-xs font-medium">URGENT</span>';
                }
                html += '</div></div></div>';
            }
            
            noticesDisplay.innerHTML = html;
        }

        function displayTimeSlots() {
            var slotsContainer = document.getElementById('time-slots');
            var html = '';
            
            for (var i = 0; i < timeSlots.length; i++) {
                var slot = timeSlots[i];
                var available = slot.total - slot.booked;
                var statusClass = available > 0 ? 'text-green-600' : 'text-red-600';
                var statusText = available > 0 ? available + ' seats available' : 'Full';
                var buttonClass = available > 0 ? 'hover:border-orange-500 cursor-pointer' : 'opacity-50 cursor-not-allowed';
                
                html += '<button onclick="selectSlot(\'' + slot.time + '\', \'' + slot.label + '\', ' + available + ')" class="p-4 border-2 border-gray-200 rounded-lg transition-colors text-left ' + buttonClass + '" ' + (available <= 0 ? 'disabled' : '') + '>';
                html += '<p class="font-medium">' + slot.label + '</p>';
                html += '<p class="text-sm ' + statusClass + '">' + statusText + '</p>';
                html += '</button>';
            }
            
            slotsContainer.innerHTML = html;
        }

        function selectSlot(timeSlot, label, available) {
            if (available <= 0) {
                showNotification('‚ùå', 'Slot Full', 'This time slot is fully booked');
                return;
            }
            
            selectedSlot = { time: timeSlot, label: label, available: available };
            document.getElementById('selected-slot-info').classList.remove('hidden');
            document.getElementById('selected-time-text').textContent = label;
            
            var bookBtn = document.getElementById('book-btn');
            bookBtn.disabled = false;
            bookBtn.textContent = 'Book Seat';
        }

        function bookSeat() {
            if (!selectedSlot) return;
            
            const token = localStorage.getItem('token');
            fetch('http://localhost:5000/api/bookings', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({
                    timeSlot: selectedSlot.time
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.booking) {
                    bookings.unshift(data.booking);
                    selectedSlot = null;
                    document.getElementById('selected-slot-info').classList.add('hidden');
                    document.getElementById('book-btn').disabled = true;
                    document.getElementById('book-btn').textContent = 'Select a Time Slot';
                    
                    loadTimeSlots();
                    displayBookings();
                    showNotification('ü™ë', 'Seat Booked!', 'Your seat has been booked for ' + data.booking.timeSlot);
                } else {
                    showNotification('‚ùå', 'Booking Failed', data.message || 'Failed to book seat');
                }
            })
            .catch(error => {
                console.error('Booking error:', error);
                showNotification('‚ùå', 'Booking Failed', 'Network error. Please try again.');
            });
        }

        function addToCart(itemId) {
            var item = null;
            for (var i = 0; i < menuItems.length; i++) {
                if (menuItems[i]._id === itemId) {
                    item = menuItems[i];
                    break;
                }
            }
            
            if (!item || !item.available) return;
            
            var existingItem = null;
            for (var i = 0; i < cart.length; i++) {
                if (cart[i].id === itemId) {
                    existingItem = cart[i];
                    break;
                }
            }
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id: item._id,
                    name: item.name,
                    price: item.price,
                    emoji: item.emoji,
                    imageUrl: item.imageUrl, // Store image URL in cart
                    quantity: 1
                });
            }
            
            updateCartDisplay();
            showNotification('üõí', 'Added to Cart', item.name + ' added to your cart');
        }

        function updateCartDisplay() {
            var cartCount = document.getElementById('cart-count');
            var cartItems = document.getElementById('cart-items');
            var cartTotal = document.getElementById('cart-total');
            var placeOrderBtn = document.getElementById('place-order-btn');
            
            var totalItems = 0;
            var totalPrice = 0;
            
            for (var i = 0; i < cart.length; i++) {
                totalItems += cart[i].quantity;
                totalPrice += cart[i].price * cart[i].quantity;
            }
            
            cartCount.textContent = totalItems;
            cartTotal.textContent = '$' + totalPrice.toFixed(2);
            
            if (cart.length === 0) {
                cartItems.innerHTML = '<div class="text-center py-8 text-gray-500"><span class="text-4xl mb-2 block">üõí</span><p>Your cart is empty</p></div>';
                placeOrderBtn.disabled = true;
                placeOrderBtn.textContent = 'Add Items to Cart';
            } else {
                var html = '';
                for (var i = 0; i < cart.length; i++) {
                    var item = cart[i];
                    html += '<div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg mb-3">';
                    html += '<div class="flex items-center space-x-3">';
                    
                    // FIXED: Check if imageUrl exists and is not empty in cart
                    if (item.imageUrl && item.imageUrl.trim() !== '') {
                        html += '<img src="' + item.imageUrl + '" alt="' + item.name + '" class="cart-item-image" onerror="this.style.display=\'none\'; this.nextElementSibling.style.display=\'block\';">';
                        html += '<span class="text-2xl hidden">' + (item.emoji || 'üçΩÔ∏è') + '</span>';
                    } else {
                        html += '<span class="text-2xl">' + (item.emoji || 'üçΩÔ∏è') + '</span>';
                    }
                    
                    html += '<div><h4 class="font-medium">' + item.name + '</h4>';
                    html += '<p class="text-sm text-gray-600">$' + item.price.toFixed(2) + ' each</p></div></div>';
                    html += '<div class="flex items-center space-x-2">';
                    html += '<button onclick="updateQuantity(\'' + item.id + '\', -1)" class="bg-gray-300 text-gray-700 w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-400 transition-colors">-</button>';
                    html += '<span class="font-medium w-8 text-center">' + item.quantity + '</span>';
                    html += '<button onclick="updateQuantity(\'' + item.id + '\', 1)" class="bg-orange-500 text-white w-8 h-8 rounded-full flex items-center justify-center hover:bg-orange-600 transition-colors">+</button>';
                    html += '</div></div>';
                }
                cartItems.innerHTML = html;
                placeOrderBtn.disabled = false;
                placeOrderBtn.textContent = 'Place Order ($' + totalPrice.toFixed(2) + ')';
            }
        }

        function updateQuantity(itemId, change) {
            for (var i = 0; i < cart.length; i++) {
                if (cart[i].id === itemId) {
                    cart[i].quantity += change;
                    if (cart[i].quantity <= 0) {
                        cart.splice(i, 1);
                    }
                    break;
                }
            }
            updateCartDisplay();
        }

        function toggleCart() {
            var cartSidebar = document.getElementById('cart-sidebar');
            cartSidebar.classList.toggle('translate-x-full');
        }

        function placeOrder() {
            if (cart.length === 0) return;
            
            const token = localStorage.getItem('token');
            var totalPrice = 0;
            var items = [];
            
            for (var i = 0; i < cart.length; i++) {
                totalPrice += cart[i].price * cart[i].quantity;
                items.push({
                    name: cart[i].name,
                    price: cart[i].price,
                    quantity: cart[i].quantity,
                    emoji: cart[i].emoji,
                    imageUrl: cart[i].imageUrl
                });
            }
            
            fetch('http://localhost:5000/api/orders', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({
                    items: items,
                    total: totalPrice
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.order) {
                    orders.unshift(data.order);
                    cart = [];
                    updateCartDisplay();
                    toggleCart();
                    showReceipt(data.order);
                    loadStudentOrders();
                    updateProfileDisplay();
                    
                    showNotification('‚úÖ', 'Order Placed!', 'Your order has been placed successfully');
                } else {
                    showNotification('‚ùå', 'Order Failed', data.message || 'Failed to place order');
                }
            })
            .catch(error => {
                console.error('Order error:', error);
                showNotification('‚ùå', 'Order Failed', 'Network error. Please try again.');
            });
        }

        function displayOrders() {
            var ordersList = document.getElementById('orders-list');
            var html = '';
            
            if (orders.length === 0) {
                html = '<div class="text-center py-8 text-gray-500"><span class="text-4xl mb-2 block">üçΩÔ∏è</span><p>No orders yet</p></div>';
            } else {
                for (var i = 0; i < orders.length; i++) {
                    var order = orders[i];
                    var statusClass = 'bg-yellow-100 text-yellow-800';
                    var statusIcon = '‚è≥';
                    
                    if (order.status === 'ready') {
                        statusClass = 'bg-green-100 text-green-800';
                        statusIcon = '‚úÖ';
                    } else if (order.status === 'preparing') {
                        statusClass = 'bg-blue-100 text-blue-800';
                        statusIcon = 'üë®‚Äçüç≥';
                    }
                    
                    html += '<div class="border border-gray-200 rounded-lg p-4 mb-4">';
                    html += '<div class="flex justify-between items-start mb-2">';
                    html += '<h4 class="font-semibold text-lg">' + order.orderId + '</h4>';
                    html += '<span class="px-3 py-1 rounded-full text-sm ' + statusClass + '">' + statusIcon + ' ' + order.status + '</span>';
                    html += '</div>';
                    html += '<p class="text-sm text-gray-600 mb-2">Items: ' + order.items.map(item => item.name + ' (' + item.quantity + ')').join(', ') + '</p>';
                    html += '<div class="flex justify-between items-center">';
                    html += '<span class="font-bold text-lg text-orange-600">$' + order.total.toFixed(2) + '</span>';
                    html += '<div class="text-right text-sm text-gray-500"><p>' + new Date(order.createdAt).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) + '</p><p>' + new Date(order.createdAt).toLocaleDateString() + '</p></div>';
                    html += '</div>';
                    // NEW: Add view receipt button
                    html += '<div class="mt-3">';
                    html += '<button onclick="viewReceipt(\'' + order.orderId + '\')" class="bg-purple-500 text-white px-3 py-1 rounded text-sm hover:bg-purple-600 transition-colors">View Receipt</button>';
                    html += '</div>';
                    html += '</div>';
                }
            }
            
            ordersList.innerHTML = html;
        }

        function displayBookings() {
            var bookingsList = document.getElementById('bookings-list');
            var html = '';
            
            if (bookings.length === 0) {
                html = '<div class="text-center py-8 text-gray-500"><span class="text-4xl mb-2 block">ü™ë</span><p>No bookings yet</p></div>';
            } else {
                for (var i = 0; i < bookings.length; i++) {
                    var booking = bookings[i];
                    html += '<div class="border border-gray-200 rounded-lg p-4 mb-4">';
                    html += '<div class="flex justify-between items-start mb-2">';
                    html += '<h4 class="font-semibold text-lg">' + booking.bookingId + '</h4>';
                    html += '<span class="px-3 py-1 rounded-full text-sm bg-green-100 text-green-800">‚úÖ ' + booking.status + '</span>';
                    html += '</div>';
                    html += '<p class="text-sm text-gray-600">Time: ' + booking.timeSlot + '</p>';
                    html += '<p class="text-sm text-gray-500">Date: ' + booking.date + '</p>';
                    html += '</div>';
                }
            }
            
            bookingsList.innerHTML = html;
        }

        function updateProfileDisplay() {
            if (!currentUser) return;
            
            document.getElementById('profile-name').textContent = currentUser.name;
            document.getElementById('profile-email').textContent = currentUser.email;
            document.getElementById('profile-type').textContent = currentUser.userType.charAt(0).toUpperCase() + currentUser.userType.slice(1);
            document.getElementById('profile-student-id').value = currentUser.studentId || '';
            document.getElementById('profile-phone').value = currentUser.phone || '';
            
            // Calculate total orders and spending
            var totalOrders = orders.length;
            var totalSpent = 0;
            for (var i = 0; i < orders.length; i++) {
                totalSpent += orders[i].total;
            }
            
            document.getElementById('profile-total-orders').textContent = totalOrders;
            document.getElementById('profile-total-spent').textContent = '$' + totalSpent.toFixed(2);
        }

        function updateProfile() {
            var phone = document.getElementById('profile-phone').value;
            const token = localStorage.getItem('token');
            
            fetch('http://localhost:5000/api/profile', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({
                    name: currentUser.name,
                    phone: phone
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.user) {
                    currentUser = data.user;
                    localStorage.setItem('user', JSON.stringify(data.user));
                    showNotification('‚úÖ', 'Profile Updated', 'Your profile information has been updated');
                } else {
                    showNotification('‚ùå', 'Update Failed', data.message || 'Failed to update profile');
                }
            })
            .catch(error => {
                console.error('Profile update error:', error);
                showNotification('‚ùå', 'Update Failed', 'Network error. Please try again.');
            });
        }

        // Owner Functions
        function initOwner() {
            updateOwnerDashboard();
            loadOwnerMenu();
            loadOwnerBookings();
            loadOwnerOrders();
            loadOwnerNotices();
            displayAnalytics();
            setupOwnerForms();
        }

        function showOwnerSection(section) {
            var sections = document.querySelectorAll('.owner-section');
            for (var i = 0; i < sections.length; i++) {
                sections[i].classList.add('hidden');
            }
            document.getElementById('owner-' + section + '-section').classList.remove('hidden');
            
            // Refresh data when switching sections
            if (section === 'dashboard') {
                updateOwnerDashboard();
            } else if (section === 'orders') {
                loadOwnerOrders();
            } else if (section === 'bookings') {
                loadOwnerBookings();
            } else if (section === 'menu') {
                loadOwnerMenu();
            } else if (section === 'notices') {
                loadOwnerNotices();
            }
        }

        // API Functions for Owner
        function loadOwnerMenu() {
            const token = localStorage.getItem('token');
            fetch('http://localhost:5000/api/admin/menu', {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            })
            .then(response => response.json())
            .then(data => {
                menuItems = data;
                displayOwnerMenu();
            })
            .catch(error => {
                console.error('Error loading owner menu:', error);
                showNotification('‚ùå', 'Error', 'Failed to load menu');
            });
        }

        function loadOwnerOrders() {
            const token = localStorage.getItem('token');
            fetch('http://localhost:5000/api/admin/orders', {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            })
            .then(response => response.json())
            .then(data => {
                ownerOrders = data;
                displayOwnerOrders();
            })
            .catch(error => {
                console.error('Error loading owner orders:', error);
                showNotification('‚ùå', 'Error', 'Failed to load orders');
            });
        }

        function loadOwnerBookings() {
            const token = localStorage.getItem('token');
            fetch('http://localhost:5000/api/admin/bookings', {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            })
            .then(response => response.json())
            .then(data => {
                bookings = data;
                displayOwnerBookings();
            })
            .catch(error => {
                console.error('Error loading owner bookings:', error);
                showNotification('‚ùå', 'Error', 'Failed to load bookings');
            });
        }

        function loadOwnerNotices() {
            const token = localStorage.getItem('token');
            fetch('http://localhost:5000/api/notices')
            .then(response => response.json())
            .then(data => {
                notices = data;
                displayOwnerNotices();
            })
            .catch(error => {
                console.error('Error loading notices:', error);
                showNotification('‚ùå', 'Error', 'Failed to load notices');
            });
        }

        function updateOwnerDashboard() {
            const token = localStorage.getItem('token');
            fetch('http://localhost:5000/api/admin/dashboard', {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('today-revenue').textContent = '$' + data.todayRevenue.toFixed(2);
                document.getElementById('today-orders').textContent = data.todayOrders;
                document.getElementById('today-bookings').textContent = data.todayBookings;
                document.getElementById('active-notices-count').textContent = data.activeNotices;
                
                // Update popular items in analytics
                displayAnalytics(data.popularItems);
            })
            .catch(error => {
                console.error('Dashboard error:', error);
            });
        }

        function displayOwnerMenu() {
            var menuList = document.getElementById('owner-menu-list');
            var html = '';
            
            for (var i = 0; i < menuItems.length; i++) {
                var item = menuItems[i];
                html += '<div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg mb-4">';
                html += '<div class="flex items-center space-x-4">';
                
                // FIXED: Check if imageUrl exists and is not empty in owner menu
                if (item.imageUrl && item.imageUrl.trim() !== '') {
                    html += '<img src="' + item.imageUrl + '" alt="' + item.name + '" class="owner-menu-image" onerror="this.style.display=\'none\'; this.nextElementSibling.style.display=\'block\';">';
                    html += '<span class="text-3xl hidden">' + (item.emoji || 'üçΩÔ∏è') + '</span>';
                } else {
                    html += '<span class="text-3xl">' + (item.emoji || 'üçΩÔ∏è') + '</span>';
                }
                
                html += '<div>';
                html += '<h4 class="font-semibold">' + item.name + '</h4>';
                html += '<p class="text-sm text-gray-600">' + item.description + '</p>';
                html += '<div class="flex items-center space-x-2 mt-1">';
                html += '<span class="px-2 py-1 rounded-full text-xs ' + (item.available ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800') + '">';
                html += item.available ? 'Available' : 'Out of Stock';
                html += '</span>';
                html += '<span class="px-2 py-1 rounded-full text-xs bg-gray-100 text-gray-800 capitalize">' + item.category + '</span>';
                if (item.popular) {
                    html += '<span class="px-2 py-1 rounded-full text-xs bg-orange-100 text-orange-800">Popular</span>';
                }
                html += '</div></div></div>';
                html += '<div class="text-right">';
                html += '<p class="text-xl font-bold text-orange-500">$' + item.price.toFixed(2) + '</p>';
                html += '<div class="mt-2 flex space-x-2">';
                html += '<button onclick="toggleAvailability(\'' + item._id + '\', ' + item.available + ')" class="px-3 py-1 rounded text-sm ' + (item.available ? 'bg-yellow-500 text-white' : 'bg-green-500 text-white') + '">';
                html += item.available ? 'Mark Unavailable' : 'Mark Available';
                html += '</button>';
                html += '<button onclick="togglePopular(\'' + item._id + '\', ' + item.popular + ')" class="px-3 py-1 rounded text-sm ' + (item.popular ? 'bg-purple-500 text-white' : 'bg-gray-500 text-white') + '">';
                html += item.popular ? 'Unmark Popular' : 'Mark Popular';
                html += '</button>';
                // Add remove item button
                html += '<button onclick="removeMenuItem(\'' + item._id + '\')" class="px-3 py-1 rounded text-sm bg-red-500 text-white">Remove</button>';
                html += '</div></div></div>';
            }
            
            menuList.innerHTML = html;
        }

        function toggleAvailability(itemId, currentStatus) {
            const token = localStorage.getItem('token');
            fetch(`http://localhost:5000/api/admin/menu/${itemId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({
                    available: !currentStatus
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.menuItem) {
                    loadOwnerMenu();
                    showNotification('üçΩÔ∏è', 'Menu Updated', 'Item availability updated');
                } else {
                    showNotification('‚ùå', 'Update Failed', data.message || 'Failed to update item');
                }
            })
            .catch(error => {
                console.error('Toggle availability error:', error);
                showNotification('‚ùå', 'Update Failed', 'Network error. Please try again.');
            });
        }

        function togglePopular(itemId, currentStatus) {
            const token = localStorage.getItem('token');
            fetch(`http://localhost:5000/api/admin/menu/${itemId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({
                    popular: !currentStatus
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.menuItem) {
                    loadOwnerMenu();
                    showNotification('‚≠ê', 'Menu Updated', 'Item popularity updated');
                } else {
                    showNotification('‚ùå', 'Update Failed', data.message || 'Failed to update item');
                }
            })
            .catch(error => {
                console.error('Toggle popular error:', error);
                showNotification('‚ùå', 'Update Failed', 'Network error. Please try again.');
            });
        }

        // Remove menu item function
        function removeMenuItem(itemId) {
            if (confirm('Are you sure you want to remove this item from the menu?')) {
                const token = localStorage.getItem('token');
                fetch(`http://localhost:5000/api/admin/menu/${itemId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        loadOwnerMenu();
                        showNotification('üóëÔ∏è', 'Item Removed', 'Menu item has been removed');
                    } else {
                        showNotification('‚ùå', 'Remove Failed', data.message || 'Failed to remove item');
                    }
                })
                .catch(error => {
                    console.error('Remove item error:', error);
                    showNotification('‚ùå', 'Remove Failed', 'Network error. Please try again.');
                });
            }
        }

        function displayOwnerBookings() {
            var bookingOverview = document.getElementById('booking-overview');
            var html = '';
            
            // First load current time slots to get capacity info
            fetch('http://localhost:5000/api/time-slots')
            .then(response => response.json())
            .then(timeSlotsData => {
                for (var i = 0; i < timeSlotsData.length; i++) {
                    var slot = timeSlotsData[i];
                    var slotBookings = bookings.filter(booking => booking.timeSlot === slot.label);
                    var percentage = (slotBookings.length / slot.total) * 100;
                    var colorClass = 'bg-green-500';
                    if (percentage > 80) colorClass = 'bg-red-500';
                    else if (percentage > 60) colorClass = 'bg-yellow-500';
                    
                    html += '<div class="border border-gray-200 rounded-lg p-4 mb-4">';
                    html += '<div class="flex justify-between items-center mb-2">';
                    html += '<h4 class="font-semibold">' + slot.label + '</h4>';
                    html += '<span class="text-lg font-bold">' + slotBookings.length + '/' + slot.total + '</span>';
                    html += '</div>';
                    html += '<div class="w-full bg-gray-200 rounded-full h-2 mb-2">';
                    html += '<div class="' + colorClass + ' h-2 rounded-full" style="width: ' + percentage + '%"></div>';
                    html += '</div>';
                    html += '<div class="flex justify-between text-sm text-gray-600">';
                    html += '<span>' + percentage.toFixed(0) + '% occupied</span>';
                    html += '<span>' + (slot.total - slotBookings.length) + ' seats left</span>';
                    html += '</div>';
                    
                    // Show booking details
                    if (slotBookings.length > 0) {
                        html += '<div class="mt-3 pt-3 border-t">';
                        html += '<p class="text-sm font-medium text-gray-700 mb-2">Bookings:</p>';
                        for (var j = 0; j < Math.min(slotBookings.length, 3); j++) {
                            var booking = slotBookings[j];
                            html += '<p class="text-xs text-gray-600">' + booking.bookingId + ' - ' + new Date(booking.createdAt).toLocaleDateString() + '</p>';
                        }
                        if (slotBookings.length > 3) {
                            html += '<p class="text-xs text-gray-500">+ ' + (slotBookings.length - 3) + ' more</p>';
                        }
                        html += '</div>';
                    }
                    html += '</div>';
                }
                
                bookingOverview.innerHTML = html;
            })
            .catch(error => {
                console.error('Error loading time slots:', error);
                bookingOverview.innerHTML = '<p class="text-center text-gray-500">Error loading booking data</p>';
            });
        }

        function updateCapacity() {
            var newCapacity = parseInt(document.getElementById('total-seats').value);
            if (newCapacity > 0) {
                const token = localStorage.getItem('token');
                fetch('http://localhost:5000/api/admin/time-slots/capacity', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        capacity: newCapacity
                    })
                })
                .then(response => response.json())
                .then(data => {
                    showNotification('ü™ë', 'Capacity Updated', 'Seat capacity set to ' + newCapacity + ' per slot');
                    loadOwnerBookings();
                })
                .catch(error => {
                    console.error('Update capacity error:', error);
                    showNotification('‚ùå', 'Update Failed', 'Failed to update capacity');
                });
            }
        }

        function displayOwnerOrders() {
            var ordersList = document.getElementById('owner-orders-list');
            var html = '';
            
            if (ownerOrders.length === 0) {
                html = '<div class="text-center py-8 text-gray-500"><span class="text-4xl mb-2 block">üìã</span><p>No active orders</p></div>';
            } else {
                for (var i = 0; i < ownerOrders.length; i++) {
                    var order = ownerOrders[i];
                    var statusClass = 'bg-yellow-100 text-yellow-800';
                    var statusIcon = '‚è≥';
                    
                    if (order.status === 'ready') {
                        statusClass = 'bg-green-100 text-green-800';
                        statusIcon = '‚úÖ';
                    } else if (order.status === 'preparing') {
                        statusClass = 'bg-blue-100 text-blue-800';
                        statusIcon = 'üë®‚Äçüç≥';
                    } else if (order.status === 'completed') {
                        statusClass = 'bg-gray-100 text-gray-800';
                        statusIcon = 'üì¶';
                    }
                    
                    html += '<div class="border border-gray-200 rounded-lg p-4 mb-4">';
                    html += '<div class="flex justify-between items-start mb-3">';
                    html += '<div><h4 class="font-semibold text-lg">' + order.orderId + '</h4>';
                    html += '<p class="text-gray-600">Student ID: ' + order.userId + '</p></div>';
                    html += '<div class="text-right">';
                    html += '<span class="text-lg font-bold text-orange-600">$' + order.total.toFixed(2) + '</span>';
                    html += '<div class="mt-1"><span class="px-3 py-1 rounded-full text-sm ' + statusClass + '">' + statusIcon + ' ' + order.status + '</span></div>';
                    html += '</div></div>';
                    html += '<p class="text-sm text-gray-600 mb-3">Items: ' + order.items.map(item => item.name + ' (' + item.quantity + ')').join(', ') + '</p>';
                    html += '<div class="flex space-x-2">';
                    html += '<button onclick="viewReceipt(\'' + order.orderId + '\')" class="bg-purple-500 text-white px-3 py-1 rounded text-sm hover:bg-purple-600 transition-colors">View Receipt</button>';
                    if (order.status === 'pending') {
                        html += '<button onclick="updateOrderStatus(\'' + order.orderId + '\', \'preparing\')" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600 transition-colors">Start Preparing</button>';
                    } else if (order.status === 'preparing') {
                        html += '<button onclick="updateOrderStatus(\'' + order.orderId + '\', \'ready\')" class="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600 transition-colors">Mark Ready</button>';
                    } else if (order.status === 'ready') {
                        html += '<button onclick="updateOrderStatus(\'' + order.orderId + '\', \'completed\')" class="bg-gray-500 text-white px-3 py-1 rounded text-sm hover:bg-gray-600 transition-colors">Mark Completed</button>';
                    }
                    html += '</div>';
                    html += '<p class="text-xs text-gray-500 mt-2">Ordered: ' + new Date(order.createdAt).toLocaleString() + '</p>';
                    html += '</div>';
                }
            }
            
            ordersList.innerHTML = html;
        }

        function updateOrderStatus(orderId, newStatus) {
            const token = localStorage.getItem('token');
            fetch(`http://localhost:5000/api/admin/orders/${orderId}/status`, {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({
                    status: newStatus
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.order) {
                    loadOwnerOrders();
                    showNotification('üìã', 'Order Updated', 'Order ' + orderId + ' marked as ' + newStatus);
                } else {
                    showNotification('‚ùå', 'Update Failed', data.message || 'Failed to update order');
                }
            })
            .catch(error => {
                console.error('Update order status error:', error);
                showNotification('‚ùå', 'Update Failed', 'Network error. Please try again.');
            });
        }

        function displayOwnerNotices() {
            var noticesList = document.getElementById('notices-list');
            var html = '';
            
            if (notices.length === 0) {
                html = '<div class="text-center py-8 text-gray-500"><span class="text-4xl mb-2 block">üì¢</span><p>No active notices</p></div>';
            } else {
                for (var i = 0; i < notices.length; i++) {
                    var notice = notices[i];
                    var bgClass = 'bg-blue-50 border-blue-200';
                    var icon = '‚ÑπÔ∏è';
                    
                    if (notice.type === 'warning') {
                        bgClass = 'bg-yellow-50 border-yellow-200';
                        icon = '‚ö†Ô∏è';
                    } else if (notice.type === 'closure') {
                        bgClass = 'bg-red-50 border-red-200';
                        icon = 'üö´';
                    } else if (notice.type === 'special') {
                        bgClass = 'bg-green-50 border-green-200';
                        icon = 'üéâ';
                    }

                    html += '<div class="border rounded-lg p-4 mb-4 ' + bgClass + '">';
                    html += '<div class="flex justify-between items-start mb-2">';
                    html += '<div class="flex items-center space-x-2">';
                    html += '<span class="text-xl">' + icon + '</span>';
                    html += '<h4 class="font-semibold">' + notice.title + '</h4>';
                    if (notice.urgent) html += '<span class="bg-red-500 text-white px-2 py-1 rounded-full text-xs">URGENT</span>';
                    html += '</div>';
                    html += '<button onclick="deleteNotice(\'' + notice._id + '\')" class="text-red-500 hover:text-red-700 text-sm">Delete</button>';
                    html += '</div>';
                    html += '<p class="text-gray-700">' + notice.message + '</p>';
                    html += '<p class="text-xs text-gray-500 mt-2">Posted: ' + new Date(notice.createdAt).toLocaleString() + '</p>';
                    html += '</div>';
                }
            }
            
            noticesList.innerHTML = html;
        }

        function deleteNotice(noticeId) {
            if (confirm('Are you sure you want to delete this notice?')) {
                const token = localStorage.getItem('token');
                fetch(`http://localhost:5000/api/admin/notices/${noticeId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                })
                .then(response => response.json())
                .then(data => {
                    loadOwnerNotices();
                    showNotification('üóëÔ∏è', 'Notice Deleted', 'The notice has been removed');
                })
                .catch(error => {
                    console.error('Delete notice error:', error);
                    showNotification('‚ùå', 'Delete Failed', 'Failed to delete notice');
                });
            }
        }

        function displayAnalytics(popularItems = []) {
            // Popular items
            var popularItemsContainer = document.getElementById('popular-items');
            var html = '';
            
            if (popularItems.length > 0) {
                for (var i = 0; i < popularItems.length; i++) {
                    var item = popularItems[i];
                    html += '<div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">';
                    html += '<div class="flex items-center space-x-3">';
                    // NEW: Use image URL if available, otherwise use emoji
                    if (item.imageUrl && item.imageUrl.trim() !== '') {
                        html += '<img src="' + item.imageUrl + '" alt="' + item.name + '" class="w-12 h-12 object-cover rounded-lg" onerror="this.style.display=\'none\'; this.nextElementSibling.style.display=\'block\';">';
                        html += '<span class="text-2xl hidden">' + (item.emoji || 'üçΩÔ∏è') + '</span>';
                    } else {
                        html += '<span class="text-2xl">' + (item.emoji || 'üçΩÔ∏è') + '</span>';
                    }
                    html += '<div><h4 class="font-medium">' + item.name + '</h4>';
                    html += '<p class="text-sm text-gray-600">$' + item.price.toFixed(2) + '</p></div></div>';
                    html += '<span class="bg-orange-100 text-orange-800 px-2 py-1 rounded-full text-xs font-medium">Popular</span>';
                    html += '</div>';
                }
            } else {
                html = '<p class="text-gray-500 text-center py-4">No popular items identified yet</p>';
            }
            popularItemsContainer.innerHTML = html;
        }

        function setupOwnerForms() {
            // Add Item Form
            document.getElementById('add-item-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                var name = document.getElementById('item-name').value;
                var price = parseFloat(document.getElementById('item-price').value);
                var category = document.getElementById('item-category').value;
                var description = document.getElementById('item-description').value;
                var imageUrl = document.getElementById('item-image-url').value;
                
                if (name && price && category && description) {
                    const token = localStorage.getItem('token');
                    fetch('http://localhost:5000/api/admin/menu', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({
                            name: name,
                            price: price,
                            category: category,
                            description: description,
                            imageUrl: imageUrl // Include image URL in the request
                        })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.menuItem) {
                            loadOwnerMenu();
                            this.reset();
                            showNotification('üçΩÔ∏è', 'Menu Updated!', 'New item added successfully');
                        } else {
                            showNotification('‚ùå', 'Add Failed', data.message || 'Failed to add item');
                        }
                    })
                    .catch(error => {
                        console.error('Add item error:', error);
                        showNotification('‚ùå', 'Add Failed', 'Network error. Please try again.');
                    });
                }
            });

            // Notice Form
            document.getElementById('notice-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                var type = document.getElementById('notice-type').value;
                var title = document.getElementById('notice-title').value;
                var message = document.getElementById('notice-message').value;
                var expiry = document.getElementById('notice-expiry').value;
                var urgent = document.getElementById('notice-urgent').checked;

                if (title && message) {
                    const token = localStorage.getItem('token');
                    fetch('http://localhost:5000/api/admin/notices', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({
                            title: title,
                            message: message,
                            type: type,
                            urgent: urgent
                        })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.notice) {
                            loadOwnerNotices();
                            this.reset();
                            showNotification('üì¢', 'Notice Published!', 'Your notice is now visible to students');
                        } else {
                            showNotification('‚ùå', 'Publish Failed', data.message || 'Failed to publish notice');
                        }
                    })
                    .catch(error => {
                        console.error('Create notice error:', error);
                        showNotification('‚ùå', 'Publish Failed', 'Network error. Please try again.');
                    });
                }
            });
        }

        // NEW: View receipt function
        function viewReceipt(orderId) {
            // Find the order in student orders or owner orders
            var order = null;
            for (var i = 0; i < orders.length; i++) {
                if (orders[i].orderId === orderId) {
                    order = orders[i];
                    break;
                }
            }
            if (!order) {
                for (var i = 0; i < ownerOrders.length; i++) {
                    if (ownerOrders[i].orderId === orderId) {
                        order = ownerOrders[i];
                        break;
                    }
                }
            }
            
            if (order) {
                showReceipt(order);
            } else {
                showNotification('‚ùå', 'Error', 'Could not find order details');
            }
        }

        // NEW: Enhanced show receipt function
        function showReceipt(order) {
            var receiptContent = document.getElementById('receipt-content');
            var html = '';
            
            html += '<div class="text-center mb-4">';
            html += '<p class="text-sm text-gray-600">Order ID: ' + order.orderId + '</p>';
            html += '<p class="text-sm text-gray-600">Date: ' + new Date(order.createdAt).toLocaleString() + '</p>';
            html += '</div>';
            
            html += '<div class="border-t border-b py-4 mb-4">';
            for (var i = 0; i < order.items.length; i++) {
                var item = order.items[i];
                html += '<div class="flex justify-between items-center mb-2">';
                html += '<div class="flex items-center space-x-3">';
                // FIXED: Check if imageUrl exists and is not empty in receipt
                if (item.imageUrl && item.imageUrl.trim() !== '') {
                    html += '<img src="' + item.imageUrl + '" alt="' + item.name + '" class="receipt-item-image" onerror="this.style.display=\'none\'; this.nextElementSibling.style.display=\'block\';">';
                    html += '<span class="text-xl hidden">' + (item.emoji || 'üçΩÔ∏è') + '</span>';
                } else {
                    html += '<span class="text-xl">' + (item.emoji || 'üçΩÔ∏è') + '</span>';
                }
                html += '<div><p class="font-medium">' + item.name + '</p>';
                html += '<p class="text-sm text-gray-600">Qty: ' + item.quantity + ' √ó $' + item.price.toFixed(2) + '</p></div>';
                html += '</div>';
                html += '<span class="font-medium">$' + (item.price * item.quantity).toFixed(2) + '</span>';
                html += '</div>';
            }
            html += '</div>';
            
            html += '<div class="flex justify-between items-center font-bold text-lg">';
            html += '<span>Total:</span>';
            html += '<span>$' + order.total.toFixed(2) + '</span>';
            html += '</div>';
            
            if (order.status) {
                html += '<div class="mt-4 text-center">';
                html += '<span class="px-3 py-1 rounded-full text-sm ' + 
                    (order.status === 'ready' ? 'bg-green-100 text-green-800' : 
                     order.status === 'preparing' ? 'bg-blue-100 text-blue-800' : 
                     'bg-yellow-100 text-yellow-800') + '">' + 
                    order.status.charAt(0).toUpperCase() + order.status.slice(1) + '</span>';
                html += '</div>';
            }
            
            receiptContent.innerHTML = html;
            document.getElementById('receipt-modal').classList.remove('hidden');
        }

        function closeReceipt() {
            document.getElementById('receipt-modal').classList.add('hidden');
        }

        // Utility Functions
        function showNotification(icon, title, message) {
            var notification = document.getElementById('notification');
            document.getElementById('notification-icon').textContent = icon;
            document.getElementById('notification-title').textContent = title;
            document.getElementById('notification-message').textContent = message;
            
            notification.classList.remove('translate-x-full');
            
            setTimeout(function() {
                notification.classList.add('translate-x-full');
            }, 3000);
        }
    </script>
</body>
</html>